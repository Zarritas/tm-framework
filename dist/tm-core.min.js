/*!
 * TM Framework - Core (minified)
 * Version: 1.0.0
 * Built: 2026-02-05T16:11:02.369Z
 * Author: JesÃºs Lorenzo
 * License: MIT
 */
/*! * TM Framework - Core * Version:1.0.0 * Built:2026-02-05T16:11:02.367Z * Author:JesÃºs Lorenzo * License:MIT */  const  TMLogger =( function (){'use strict'; const  Logger ={config:{enabled:false,level:'warn',prefix:'[TM]',timestamps:false,},levels:{debug:0,info:1,warn:2,error:3,},configure(options ={}){Object.assign(this.config,options);},shouldLog(level){ if (!this.config.enabled) return  false; return  this.levels[level]>= this.levels[this.config.level];},format(module,message){ const  parts =[this.config.prefix]; if (this.config.timestamps){parts.push( new  Date().toISOString());}parts.push(`[${module}]`);parts.push(message); return  parts.join(' ');},log(level,module,message,data){ if (!this.shouldLog(level)) return ; const  formatted = this.format(module,message); const  method = level === 'debug' ? 'log':level; if (data !== undefined){console[method](formatted,data);} else {console[method](formatted);}},debug(module,message,data){this.log('debug',module,message,data);},info(module,message,data){this.log('info',module,message,data);},warn(module,message,data){this.log('warn',module,message,data);},error(module,message,data){this.log('error',module,message,data);},}; return {Logger};})(); if ( typeof  window !== 'undefined'){globalThis.TMLogger = TMLogger;} if ( typeof  module !== 'undefined' && module.exports){module.exports = TMLogger;} const  TMReactive =( function (){'use strict'; function  reactive(obj){ const  listeners =  new  Set(); const  handler ={get(target,prop){ if (prop === '__isReactive') return  true; if (prop === '__listeners') return  listeners; if (prop === '__subscribe'){ return (fn)=>{listeners.add(fn); return ()=> listeners.delete(fn);};} if (prop === '__raw') return  target; const  value = target[prop]; if (value &&  typeof  value === 'object' && !value.__isReactive){target[prop]= reactive(value); return  target[prop];} return  value;},set(target,prop,value){ const  oldValue = target[prop]; if (oldValue !== value){target[prop]= value;listeners.forEach(fn =>{try{fn(prop,value,oldValue);}catch(e){ if ( typeof  TMLogger !== 'undefined' && TMLogger?.Logger?.error){TMLogger.Logger.error('Reactive','Listener error',e);} else {console.error('[TM][Reactive]Listener error',e);}}});} return  true;},deleteProperty(target,prop){ if (prop in target){ const  oldValue = target[prop];delete target[prop];listeners.forEach(fn => fn(prop,undefined,oldValue));} return  true;}}; return   new  Proxy(obj,handler);} function  computed(fn,deps =[]){ let  cached; let  dirty = true;deps.forEach(dep =>{ if (dep?.__subscribe){dep.__subscribe(()=>{dirty = true;});}}); return ()=>{ if (dirty){cached = fn();dirty = false;} return  cached;};} function  watch(source,callback,options ={}){ const {immediate = false}= options; if (immediate){callback(source.__raw,undefined);} return  source.__subscribe((prop,newVal,oldVal)=>{callback(source.__raw,{prop,newVal,oldVal});});} function  ref(initialValue){ return  reactive({value:initialValue});} return {reactive,computed,watch,ref};})(); if ( typeof  window !== 'undefined'){globalThis.TMReactive = TMReactive;} const  TMComponent =( function (){'use strict'; const {reactive}= TMReactive; let  _componentCounter = 0; class  Component{static defaultProps ={};constructor(props ={}){this.props = Object.freeze({...this.constructor.defaultProps,...props});this.state = reactive(this.initialState?.()||{});this.refs ={};this._el = null;this._mounted = false;this._updateScheduled = false;this._children =  new  Map();this._unsubscribers =[];this._emittingEvents =  new  Set();this._lastRender = null;this._updateCount = 0;this._componentId = `${this.constructor.name}_${Date.now().toString(36)}_${(++_componentCounter).toString(36)}`;this._debugMode = window?.TM_DEBUG || false;this._updateLog =[];this._stateChangeLog =[];this._log('debug',`Component ${this._componentId}created with props:`,this.props); if (this.state.__subscribe){this._unsubscribers.push(this.state.__subscribe((prop,newVal,oldVal)=>{this._logStateChange(prop,newVal,oldVal); if (this._stateChangeTimeout){clearTimeout(this._stateChangeTimeout);}this._stateChangeTimeout = setTimeout(()=>{this._scheduleUpdate('state_change');this._stateChangeTimeout = null;},10);}));}}initialState(){ return {};}render(){ return  '';}onMount(){}onUpdate(){}onDestroy(){}get el(){ return  this._el;}get isMounted(){ return  this._mounted;}mount(container){ if ( typeof  container === 'string'){container = document.querySelector(container);} if (!container){TMLogger.Logger.error('Component','Container not found'); return  this;}this._el = this._createElement();container.appendChild(this._el);this._finishMount(); return  this;}insertBefore(refElement){ if (!refElement?.parentNode) return  this;this._el = this._createElement();refElement.parentNode.insertBefore(this._el,refElement);this._finishMount(); return  this;}insertAfter(refElement){ if (!refElement?.parentNode) return  this;this._el = this._createElement();refElement.parentNode.insertBefore(this._el,refElement.nextSibling);this._finishMount(); return  this;}replace(oldElement){ if (!oldElement?.parentNode) return  this;this._el = this._createElement();oldElement.parentNode.replaceChild(this._el,oldElement);this._finishMount(); return  this;}setProps(newProps){this.props = Object.freeze({...this.props,...newProps});this._scheduleUpdate();}emit(eventName,detail ={}){ if (this._emittingEvents.has(eventName)){this._log('warn',`Event ${eventName}skipped to prevent recursion`); return ;}this._emittingEvents.add(eventName);try{this._log('debug',`Emitting event:${eventName}`,detail);this._el?.dispatchEvent( new  CustomEvent(eventName,{detail,bubbles:true,composed:true}));}catch(error){this._log('error',`Error emitting event ${eventName}:`,error);}finally{this._emittingEvents.delete(eventName);}}forceUpdate(){this._update();}destroy(){this._log('info',`ðŸ—‘ï¸ DESTROYING component ${this._componentId}`); if (this._updateTimeout){clearTimeout(this._updateTimeout);this._updateTimeout = null;} if (this._stateChangeTimeout){clearTimeout(this._stateChangeTimeout);this._stateChangeTimeout = null;}this._children.forEach(child => child.destroy());this._children.clear();this._unsubscribers.forEach(unsub => unsub());this._unsubscribers =[];this._emittingEvents?.clear();this._el?.remove();this._el = null;this._mounted = false;this._updateScheduled = false;this._userInteracting = false; if ( typeof  window !== 'undefined' && window[this._componentId]){delete window[this._componentId];} if (this._debugMode || this._componentLogs?.some(log => log.level === 'error')){this._log('info',`Component ${this._componentId}final state:`,this.getDebugInfo());}}addChild(key,child){this._children.set(key,child);}getChild(key){ return  this._children.get(key);}removeChild(key){ const  child = this._children.get(key); if (child){child.destroy();this._children.delete(key);}}_createElement(){ const  rendered = this.render(); if (rendered  instanceof  HTMLElement){this._processElement(rendered); return  rendered;} const  wrapper = document.createElement('div');wrapper.innerHTML =(rendered || '').trim(); const  el = wrapper.children.length === 1 ? wrapper.firstElementChild:wrapper;this._processElement(el); return  el;}_processElement(el){ if (!el || !el.dataset) return ;el.dataset.tmComponent = this._componentId; if (!window[this._componentId]){window[this._componentId]= this;}el.querySelectorAll('[ref]').forEach(refEl =>{ const  refName = refEl.getAttribute('ref');this.refs[refName]= refEl;refEl.removeAttribute('ref');}); if (el.hasAttribute?.('ref')){this.refs[el.getAttribute('ref')]= el;el.removeAttribute('ref');}this._bindEvents(el);}_bindEvents(el){ const  processNode =(node)=>{ if (node.nodeType !== 1) return ;Array.from(node.attributes ||[]).forEach(attr =>{ if (attr.name.startsWith('@')){ const  eventName = attr.name.slice(1); const  handlerName = attr.value; if ( typeof  this[handlerName]=== ' function '){node.addEventListener(eventName,(e)=>{ if (e.detail?.originalEvent){ return ;}this[handlerName](e);});} else {TMLogger.Logger.warn('Component',`Handler "${handlerName}" not found`);}node.removeAttribute(attr.name);}});};processNode(el);el.querySelectorAll('*').forEach(processNode);this._setupInteractionTracking(el);}_setupInteractionTracking(el){ const  interactions =['mousedown','keydown','focus','input','change']; const  interactionEnd =['mouseup','keyup','blur'];interactions.forEach(event =>{el.addEventListener(event,()=>{this._setUserInteracting(true);},true);});interactionEnd.forEach(event =>{el.addEventListener(event,()=>{setTimeout(()=>{this._setUserInteracting(false);},200);},true);});}_finishMount(){this._mounted = true;this.onMount();}_scheduleUpdate(reason = 'unknown'){ if (!this._mounted){this._log('warn',`Update skipped - component not mounted(${reason})`); return ;} if (this._updateScheduled){this._log('debug',`Update already scheduled - skipping(${reason})`); return ;}this._updateScheduled = true;this._updateCount++; const  updateInfo ={reason,timestamp:Date.now(),updateCount:this._updateCount,state:this.state.__raw,props:this.props};this._log('info',`ðŸ”„ UPDATE SCHEDULED #${this._updateCount}(${reason})`,updateInfo); if (this._userInteracting){this._log('debug',`Update deferred - user interacting(${reason})`);this._updateScheduled = false;this._pendingUpdateReason = reason; return ;} if (this._updateTimeout){clearTimeout(this._updateTimeout);this._log('debug',`Previous update cancelled,scheduling  new  one`);}this._updateTimeout = setTimeout(()=>{this._updateScheduled = false;this._update(updateInfo);this._updateTimeout = null;this._updateCount = 0;},50);}_setUserInteracting(interacting = true){this._userInteracting = interacting; if (!interacting && this._pendingUpdateReason){ const  pendingReason = this._pendingUpdateReason;this._pendingUpdateReason = null;this._updateTimeout = setTimeout(()=>{this._scheduleUpdate(pendingReason);},100);}}_update(updateInfo ={}){ const  updateId = `update_${Date.now().toString(36)}`; if (!this._el || !this._mounted){this._log('warn',`Update ${updateId}cancelled - no element or not mounted`); return ;} if (this._updateCount > 5){this._log('error',`Update ${updateId}SKIPPED - too many updates(${this._updateCount})`); return ;} const  startTime = performance.now();this._log('info',`ðŸ”„ UPDATE STARTING ${updateId}`,{...updateInfo,updateId});try{ const  rendered = this.render(); const  renderString = rendered  instanceof  HTMLElement ? rendered.outerHTML:String(rendered ?? '') if (this._lastRender === renderString){this._log('debug',`Update ${updateId}SKIPPED - no render changes`); return ;}this._lastRender = renderString;this._log('debug',`Update ${updateId}- render changed,proceeding`); const  scrollPos = this._el.scrollTop; const  newEl = rendered  instanceof  HTMLElement ? rendered:(()=>{ const  wrapper = document.createElement('div');wrapper.innerHTML = renderString.trim(); return  wrapper.children.length === 1 ? wrapper.firstElementChild:wrapper;})(); if (this._shouldUpdate(this._el,newEl)){this._log('info',`Update ${updateId}- DOM CHANGED,replacing element`);this._processElement(newEl); const  oldInfo ={tagName:this._el?.tagName || 'unknown',className:this._el?.className || '',childCount:this._el?.children?.length ?? 0,innerHTMLLength:this._el?.innerHTML?.length ?? 0};this._el.replaceWith(newEl);this._el = newEl; if (this._el)this._el.scrollTop = scrollPos; const  newInfo ={tagName:this._el?.tagName || 'unknown',className:this._el?.className || '',childCount:this._el?.children?.length ?? 0,innerHTMLLength:this._el?.innerHTML?.length ?? 0};this._log('info',`Update ${updateId}- REPLACEMENT COMPLETE`,{old:oldInfo, new :newInfo});} else {this._log('debug',`Update ${updateId}- SKIPPED - no significant DOM changes`);}}catch(error){this._log('error',`Update ${updateId}FAILED:`,error);} const  updateTime = performance.now()- startTime;this._log('performance',`Update ${updateId}completed in ${updateTime.toFixed(2)}ms`); if (updateTime > 100){this._log('warn',`âš ï¸ SLOW UPDATE ${updateId}:${updateTime.toFixed(2)}ms`,{updateInfo});}this._updateLog.push({id:updateId,timestamp:Date.now(),duration:updateTime,reason:updateInfo.reason,stateSnapshot:this.state.__raw,successful:true}); if (this._updateLog.length > 20){this._updateLog = this._updateLog.slice(-20);}this.onUpdate();}_log(level,message,data = null){ const  timestamp =  new  Date().toISOString(); const  logEntry ={timestamp,component:this._componentId,level,message,data}; const  prefix = `[${timestamp}][${this._componentId}][${level.toUpperCase()}]`;switch(level){case 'error':console.error(prefix,message,data);break;case 'warn':console.warn(prefix,message,data);break;case 'info':console.info(prefix,message,data);break;case 'performance':console.info(`%c${prefix}${message}`,'color:#8A2BE2',data);break;default: if (this._debugMode){console.log(prefix,message,data);}} if (['error','warn','info','performance'].includes(level)){ if (!this._componentLogs)this._componentLogs =[];this._componentLogs.push(logEntry); if (this._componentLogs.length > 50){this._componentLogs = this._componentLogs.slice(-50);}}}_logStateChange(prop,newVal,oldVal){ const  changeEntry ={timestamp:Date.now(),property:prop,oldValue:oldVal,newValue:newVal,type:this._getChangeType(newVal,oldVal),stackTrace:this._debugMode ?  new  Error().stack:null};this._stateChangeLog.push(changeEntry); if (this._stateChangeLog.length > 30){this._stateChangeLog = this._stateChangeLog.slice(-30);} if (this._debugMode || this._isSignificantChange(newVal,oldVal)){this._log('debug',`ðŸ”„ STATE CHANGE:${prop}`,changeEntry);}}_getChangeType(newVal,oldVal){ if (newVal === oldVal) return  'none'; if ( typeof  newVal !==  typeof  oldVal) return  'type_change'; if (Array.isArray(newVal)&& Array.isArray(oldVal)){ return  newVal.length !== oldVal.length ? 'array_length':'array_content';} if ( typeof  newVal === 'object' &&  typeof  oldVal === 'object'){ return  'object_content';} return  'value_change';}_isSignificantChange(newVal,oldVal){ if ( typeof  newVal !==  typeof  oldVal) return  true; if (Array.isArray(newVal)&& Array.isArray(oldVal)){ return  newVal.length !== oldVal.length;} if ( typeof  newVal === 'object' &&  typeof  oldVal === 'object'){ return  JSON.stringify(newVal)!== JSON.stringify(oldVal);} return  newVal !== oldVal;}getDebugInfo(){ return {componentId:this._componentId,mounted:this._mounted,updateScheduled:this._updateScheduled,updateCount:this._updateCount,lastRender:this._lastRender ? this._lastRender.substring(0,200)+ '...':null,updateHistory:this._updateLog.slice(-10),stateChangeHistory:this._stateChangeLog.slice(-10),componentLogs:this._componentLogs ? this._componentLogs.slice(-20):[],currentProps:this.props,currentState:this.state.__raw,refs:Object.keys(this.refs),childrenCount:this._children.size};}debug(){ const  info = this.getDebugInfo();console.group(`ðŸ” TM Component Debug:${this._componentId}`);console.log('Component Info:',info); if (info.updateHistory.length > 0){console.group('ðŸ“ˆ Update History');info.updateHistory.forEach((update,i)=>{console.log(`${i + 1}.`,update);});console.groupEnd();} if (info.stateChangeHistory.length > 0){console.group('ðŸ”„ State Change History');info.stateChangeHistory.forEach((change,i)=>{console.log(`${i + 1}.`,change);});console.groupEnd();}console.groupEnd(); return  info;}_shouldUpdate(oldEl,newEl){ if (!oldEl || !newEl) return  true; const  oldChildren = oldEl.children; const  newChildren = newEl.children; if (!oldChildren || !newChildren) return  true; if (oldEl.className !== newEl.className) return  true; if (oldChildren.length === 0 && newChildren.length === 0){ return  oldEl.textContent !== newEl.textContent;} if (oldChildren.length !== newChildren.length) return  true; if (oldEl.innerHTML !== newEl.innerHTML){ return  this._hasSignificantChanges(oldEl,newEl);} return  false;}_hasSignificantChanges(oldEl,newEl){ const  oldData = Array.from(oldEl.attributes).filter(attr => attr.name.startsWith('data-')); const  newData = Array.from(newEl.attributes).filter(attr => attr.name.startsWith('data-')); const  oldNonData = Array.from(oldEl.attributes).filter(attr => !attr.name.startsWith('data-')); const  newNonData = Array.from(newEl.attributes).filter(attr => !attr.name.startsWith('data-')); return  oldNonData.length !== newNonData.length || oldNonData.some(attr => attr.value !== newEl.getAttribute(attr.name));}} return {Component};})(); if ( typeof  window !== 'undefined'){globalThis.TMComponent = TMComponent;} const  TMUtils =( function (){'use strict'; function  html(strings,...values){ return  strings.reduce((result,str,i)=>{ let  value = values[i]?? ''; if (Array.isArray(value)){value = value.join('');} if ( typeof  value === 'boolean'){value = '';} return  result + str + value;},'');} function  classNames(...args){ return  args .flat(Infinity).filter(Boolean).map(c =>{ if ( typeof  c === 'object'){ return  Object.entries(c).filter(([,v])=> v).map(([k])=> k);} return  c;}).flat().join(' ');} function  waitForElement(selector,timeout = 5000,parent = document.body){ return   new  Promise((resolve,reject)=>{ const  existing = document.querySelector(selector); if (existing) return  resolve(existing); const  observer =  new  MutationObserver((mutations,obs)=>{ const  el = document.querySelector(selector); if (el){obs.disconnect();resolve(el);}});observer.observe(parent,{childList:true,subtree:true});setTimeout(()=>{observer.disconnect();TMLogger.Logger.warn('Utils',`Element "${selector}" not found after ${timeout}ms`);reject( new  Error(`Element "${selector}" not found after ${timeout}ms`));},timeout);});} function  waitForElements(selectors,timeout = 5000){ return  Promise.all(selectors.map(s => waitForElement(s,timeout)));} function  debounce(fn,delay = 300){ let  timeoutId; return   function (...args){clearTimeout(timeoutId);timeoutId = setTimeout(()=> fn.apply(this,args),delay);};} function  throttle(fn,limit = 300){ let  inThrottle; return   function (...args){ if (!inThrottle){fn.apply(this,args);inThrottle = true;setTimeout(()=> inThrottle = false,limit);}};} function  deepClone(obj){ if (obj === null ||  typeof  obj !== 'object') return  obj; if (obj  instanceof  Date) return   new  Date(obj); if (obj  instanceof  Array) return  obj.map(deepClone); if (obj  instanceof  Object){ return  Object.fromEntries(Object.entries(obj).map(([k,v])=>[k,deepClone(v)]));} return  obj;} function  deepMerge(target,...sources){ if (!sources.length) return  target; const  source = sources.shift(); if (isObject(target)&& isObject(source)){ for ( const  key in source){ if (isObject(source[key])){ if (!target[key])Object.assign(target,{[key]:{}});deepMerge(target[key],source[key]);} else {Object.assign(target,{[key]:source[key]});}}} return  deepMerge(target,...sources);} function  isObject(item){ return  item &&  typeof  item === 'object' && !Array.isArray(item);} function  uid(prefix = 'tm'){ return  `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,9)}`;} function  escapeHtml(str){ const  div = document.createElement('div');div.textContent = str; return  div.innerHTML;} function  escapeAttr(str){ if (str == null) return  ''; return  String(str).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');} function  parseUrlParams(url = globalThis.location.href){ const  params ={}; const  searchParams =  new  URL(url).searchParams; for ( const [key,value]of searchParams){params[key]= value;} return  params;} function  formatDate(date,format = 'short'){ const  d =  new  Date(date); const  formats ={short:{day:'2-digit',month:'2-digit',year:'numeric'},long:{day:'numeric',month:'long',year:'numeric'},time:{hour:'2-digit',minute:'2-digit'},iso:null}; if (format === 'iso') return  d.toISOString().split('T')[0]; return  d.toLocaleDateString('es-ES',formats[format]|| formats.short);} const  storage ={get(key,defaultValue = null){try{ if ( typeof  GM_getValue !== 'undefined'){ const  item = GM_getValue(key,null); return  item !== null ? JSON.parse(item):defaultValue;} const  item = localStorage.getItem(key); return  item ? JSON.parse(item):defaultValue;}catch{ return  defaultValue;}},set(key,value){try{ if ( typeof  GM_setValue !== 'undefined'){GM_setValue(key,JSON.stringify(value)); return  true;}localStorage.setItem(key,JSON.stringify(value)); return  true;}catch{ return  false;}},remove(key){try{ if ( typeof  GM_deleteValue !== 'undefined'){GM_deleteValue(key);} else {localStorage.removeItem(key);}}catch{}},clear(){try{ if ( typeof  GM_listValues !== 'undefined'){ const  keys = GM_listValues();keys.forEach(key => GM_deleteValue(key));} else {localStorage.clear();}}catch{}}}; return {html,classNames,waitForElement,waitForElements,debounce,throttle,deepClone,deepMerge,uid,escapeHtml,escapeAttr,parseUrlParams,formatDate,storage};})(); if ( typeof  window !== 'undefined'){globalThis.TMUtils = TMUtils;} const  TMTheme =( function (){'use strict'; const {reactive}= TMReactive; const  state = reactive({mode:'auto',current:'light',platform:null}); const  detectors ={gitlab:()=>{ if (document.body.classList.contains('gl-dark')) return  'dark'; if (document.documentElement.classList.contains('gl-dark')) return  'dark'; if (document.body.classList.contains('ui-indigo')) return  'light'; return  null;},odoo:()=>{ const  scheme = document.body.dataset.colorScheme; if (scheme === 'dark') return  'dark'; if (scheme === 'light') return  'light'; return  null;},github:()=>{ const  mode = document.documentElement.dataset.colorMode; if (mode === 'dark') return  'dark'; if (mode === 'light') return  'light'; return  null;},meet:()=>{ if (document.body.classList.contains('dark-theme')) return  'dark'; return  'light';},system:()=>{ if (globalThis.matchMedia?.('(prefers-color-scheme:dark)').matches){ return  'dark';} return  'light';}}; function  detectTheme(){ for ( const [platform,detector]of Object.entries(detectors)){ if (platform === 'system')continue; const  result = detector(); if (result){state.platform = platform; return  result;}}state.platform = 'system'; return  detectors.system();} function  updateTheme(){state.current = state.mode === 'auto' ? detectTheme():state.mode;document.documentElement.setAttribute('data-tm-theme',state.current);document.body.setAttribute('data-tm-theme',state.current);} function  setMode(mode){ if (!['light','dark','auto'].includes(mode)){console.warn(`[TM Theme]Invalid mode:${mode}`); return ;}state.mode = mode;updateTheme();} function  toggle(){setMode(state.current === 'light' ? 'dark':'light');} let  _themeObserver = null; let  _themeMediaQuery = null; let  _themeMediaListener = null; function  init(){updateTheme();_themeMediaQuery = globalThis.matchMedia?.('(prefers-color-scheme:dark)'); if (_themeMediaQuery){_themeMediaListener =()=>{ if (state.mode === 'auto')updateTheme();};_themeMediaQuery.addEventListener('change',_themeMediaListener);}_themeObserver =  new  MutationObserver(()=>{ if (state.mode === 'auto')updateTheme();});_themeObserver.observe(document.body,{attributes:true,attributeFilter:[' class ','data-color-scheme','data-theme']});_themeObserver.observe(document.documentElement,{attributes:true,attributeFilter:[' class ','data-color-mode','data-theme']}); if ( typeof  TMLogger !== 'undefined'){TMLogger.Logger.info('Theme',`Initialized:${state.current}(platform:${state.platform})`);}} function  destroy(){ if (_themeObserver){_themeObserver.disconnect();_themeObserver = null;} if (_themeMediaQuery && _themeMediaListener){_themeMediaQuery.removeEventListener('change',_themeMediaListener);_themeMediaQuery = null;_themeMediaListener = null;}} function  getCssVar(varName){ const  name = varName.startsWith('--')? varName:`--${varName}`; return  getComputedStyle(document.documentElement).getPropertyValue(name).trim();} function  setCssVar(varName,value){ const  name = varName.startsWith('--')? varName:`--${varName}`;document.documentElement.style.setProperty(name,value);} function  addDetector(name,detector){detectors[name]= detector;} return {state,init,destroy,setMode,toggle,detectTheme,getCssVar,setCssVar,addDetector,get mode(){ return  state.mode;},get current(){ return  state.current;},get isDark(){ return  state.current === 'dark';},get isLight(){ return  state.current === 'light';},get platform(){ return  state.platform;}};})(); if ( typeof  window !== 'undefined'){globalThis.TMTheme = TMTheme;} const  TMSelector =( function (){'use strict'; const  FRAGILE_PATTERNS =[/\.css-[a-z0-9]+/i,/\.sc-[a-z]+-[a-z0-9]+/i,/\.[a-z]+_[a-z]+__[a-z0-9]+/i,/\.jsx?-\d+/i,/:nth-child\(\d+\)/,/:nth-of-type\(\d+\)/,/#[a-z]+-\d+/i,/#ember\d+/,/#react-[a-z0-9-]+/i,]; const  SELECTOR_PRIORITY ={'data-testid':10,'data-test':9,'data-qa':9,'data-cy':9,'aria-label':8,'aria-labelledby':8,'role':7,'id':6,'name':5,'type':4,'href':3,' class ':2,'tag':1,}; class  SelectorManager{constructor(name = 'TM',options ={}){this.name = name;this.selectors =  new  Map();this.stats =  new  Map();this.options ={warnOnMiss:options.warnOnMiss ?? true,logHits:options.logHits ?? false,throwOnMiss:options.throwOnMiss ?? false,cacheResults:options.cacheResults ?? false,cacheTTL:options.cacheTTL ?? 5000,...options,};this._cacheByContext =  new  WeakMap();this._documentCache =  new  Map();}register(key,selectors,options ={}){ const  selectorList = Array.isArray(selectors)? selectors:[selectors]; if (selectorList.length === 0){console.warn(`[${this.name}]Empty selector list  for  "${key}"`); return  this;}this.selectors.set(key,{list:selectorList,required:options.required ?? true,validator:options.validator ?? null,transform:options.transform ?? null,description:options.description ?? '',});this.stats.set(key,{hits:{},misses:0,lastHit:null,lastMiss:null,}); return  this;}registerAll(definitions){ for ( const [key,value]of Object.entries(definitions)){ if (Array.isArray(value)||  typeof  value === 'string'){this.register(key,value);} else {this.register(key,value.selectors,value);}} return  this;}get(key,context = document){ const  config = this.selectors.get(key); if (!config){console.error(`[${this.name}]Unknown selector key:"${key}"`); return  null;} if (this.options.cacheResults){ const  cached = this._getFromCache(key,context); if (cached !== undefined) return  cached;} for ( const  selector of config.list){try{ const  el = context.querySelector(selector); if (el && this._validate(el,config)){this._recordHit(key,selector); const  result = this._transform(el,config); if (this.options.cacheResults){this._setCache(key,context,result);} return  result;}}catch(e){ if (this.options.logHits){console.warn(`[${this.name}]Invalid selector:"${selector}"`);}}}this._recordMiss(key); if (config.required){ if (this.options.throwOnMiss){throw  new  Error(`[${this.name}]Required element not found:"${key}"`);} if (this.options.warnOnMiss){this._reportMissing(key);}} return  null;}getAll(key,context = document){ const  config = this.selectors.get(key); if (!config){console.error(`[${this.name}]Unknown selector key:"${key}"`); return [];} for ( const  selector of config.list){try{ const  els = context.querySelectorAll(selector); if (els.length > 0){ const  filtered = Array.from(els).filter(el => this._validate(el,config)); if (filtered.length > 0){this._recordHit(key,selector); return  filtered.map(el => this._transform(el,config));}}}catch(e){}}this._recordMiss(key); return [];}exists(key,context = document){ return  this.get(key,context)!== null;}waitFor(key,options ={}){ const {timeout = 10000,interval = 100,context = document.body,}= options; return   new  Promise((resolve,reject)=>{ const  safeGet =(k,ctx)=>{try{ return  this.get(k,ctx);}catch(e){ return  null;}}; const  immediate = safeGet(key,context); if (immediate) return  resolve(immediate); const  startTime = Date.now(); let  pollId = null; let  timeoutId = null; const  cleanup =()=>{ if (pollId)clearInterval(pollId); if (timeoutId)clearTimeout(timeoutId);observer.disconnect();}; const  observer =  new  MutationObserver(()=>{ const  el = safeGet(key,context); if (el){cleanup(); if (this.options.logHits){TMLogger.Logger.debug('Selector',`waitFor "${key}" resolved in ${Date.now()- startTime}ms`);}resolve(el);}});observer.observe(context,{childList:true,subtree:true,attributes:true,});timeoutId = setTimeout(()=>{cleanup(); const  config = this.selectors.get(key);reject( new  Error(`[${this.name}]Timeout waiting  for  "${key}". Tried:${config?.list.join(',')}`));},timeout);pollId = setInterval(()=>{ const  el = safeGet(key,context); if (el){cleanup(); if (this.options.logHits){TMLogger.Logger.debug('Selector',`waitFor "${key}" resolved in ${Date.now()- startTime}ms`);}resolve(el);}},interval);});}query(selectors,context = document){ const  list = Array.isArray(selectors)? selectors:[selectors]; for ( const  selector of list){try{ const  el = context.querySelector(selector); if (el) return  el;}catch(e){}} return  null;}queryAll(selectors,context = document){ const  list = Array.isArray(selectors)? selectors:[selectors]; for ( const  selector of list){try{ const  els = context.querySelectorAll(selector); if (els.length > 0) return  Array.from(els);}catch(e){}} return [];}getStats(){ const  stats ={}; for ( const [key,data]of this.stats){ const  config = this.selectors.get(key);stats[key]={...data,selectors:config?.list ||[],totalHits:Object.values(data.hits).reduce((a,b)=> a + b,0),};} return  stats;}getHealthReport(){ const  report ={total:this.selectors.size,healthy:0,degraded:0,failing:0,details:[],}; for ( const [key,stat]of this.stats){ const  config = this.selectors.get(key); const  totalHits = Object.values(stat.hits).reduce((a,b)=> a + b,0); const  primaryHits = stat.hits[config.list[0]]|| 0; let  status = 'healthy'; let  reason = ''; if (stat.misses > 0 && totalHits === 0){status = 'failing';reason = 'No successful matches';} else   if (primaryHits === 0 && totalHits > 0){status = 'degraded';reason = 'Using fallback selectors';} if (status === 'healthy')report.healthy++; else   if (status === 'degraded')report.degraded++; else  report.failing++;report.details.push({key,status,reason,primarySelector:config.list[0],usedSelector:this._getMostUsedSelector(stat),hits:totalHits,misses:stat.misses,});} return  report;}clearCache(){this._documentCache.clear();}resetStats(){ for ( const  key of this.stats.keys()){this.stats.set(key,{hits:{},misses:0,lastHit:null,lastMiss:null,});}}static isFragile(selector){ return  FRAGILE_PATTERNS.some(pattern => pattern.test(selector));}static analyzeSelector(selector){ const  issues =[]; let  score = 100; for ( const  pattern of FRAGILE_PATTERNS){ if (pattern.test(selector)){issues.push({type:'fragile-pattern',pattern:pattern.toString(),message:'Contains pattern that may change frequently',});score -= 20;}} const  depth =(selector.match(/>/g)||[]).length; if (depth > 3){issues.push({type:'deep-nesting',depth,message:`Selector has ${depth}levels of nesting`,});score -= depth * 5;} const  hasTestId = /\[data-testid/.test(selector); const  hasAriaLabel = /\[aria-label/.test(selector); const  hasRole = /\[role=/.test(selector); if (hasTestId)score += 10; if (hasAriaLabel)score += 5; if (hasRole)score += 5; return {selector,score:Math.max(0,Math.min(100,score)),issues,recommendation:score < 50 ? 'Consider adding fallback selectors':null,};}_validate(el,config){ if (!config.validator) return  true;try{ return  config.validator(el);}catch(e){ return  false;}}_transform(el,config){ if (!config.transform) return  el;try{ return  config.transform(el);}catch(e){ return  el;}}_recordHit(key,selector){ const  stat = this.stats.get(key); if (stat){stat.hits[selector]=(stat.hits[selector]|| 0)+ 1;stat.lastHit = Date.now();} if (this.options.logHits){console.log(`[${this.name}]Hit:"${key}" via "${selector}"`);}}_recordMiss(key){ const  stat = this.stats.get(key); if (stat){stat.misses++;stat.lastMiss = Date.now();}}_reportMissing(key){ const  config = this.selectors.get(key); const  stat = this.stats.get(key);console.group(`[${this.name}]Selector "${key}" not found`);console.log('Tried selectors:',config.list);console.log('Description:',config.description || '(none)');console.log('Stats:',stat);console.groupEnd();}_getMostUsedSelector(stat){ let  maxHits = 0; let  mostUsed = null; for ( const [selector,hits]of Object.entries(stat.hits)){ if (hits > maxHits){maxHits = hits;mostUsed = selector;}} return  mostUsed;}_getContextCache(context){ const  normalizedContext = context != null &&  typeof  context === 'object' ? context:document; if (normalizedContext === document){ return  this._documentCache;} let  contextCache = this._cacheByContext.get(normalizedContext); if (!contextCache){contextCache =  new  Map();this._cacheByContext.set(normalizedContext,contextCache);} return  contextCache;}_getFromCache(key,context){ const  contextCache = this._getContextCache(context); const  cacheKey = context.id ? `${key}_${context.id}`:key; const  cached = contextCache.get(cacheKey); if (cached && Date.now()- cached.time < this.options.cacheTTL){ if (cached.element && document.contains(cached.element)){ return  cached.element;}contextCache.delete(cacheKey);} return  undefined;}_setCache(key,context,element){ const  contextCache = this._getContextCache(context); const  cacheKey = context.id ? `${key}_${context.id}`:key;contextCache.set(cacheKey,{element,time:Date.now(),});}} function  findByText(tag,text,container = document){ const  elements = container.querySelectorAll(tag); return  Array.from(elements).find(el => el.textContent.trim().includes(text))|| null;} function  findRelative(anchor,selector,relationship = 'sibling'){ if (!anchor) return  null;switch(relationship){case 'parent': return  anchor.closest(selector);case 'sibling': return  anchor.parentElement?.querySelector(selector)|| null;case 'child': return  anchor.querySelector(selector);case 'next':{ let  next = anchor.nextElementSibling; while (next){ if (next.matches(selector)) return  next;next = next.nextElementSibling;} return  null;}case 'prev':{ let  prev = anchor.previousElementSibling; while (prev){ if (prev.matches(selector)) return  prev;prev = prev.previousElementSibling;} return  null;}default: return  null;}} function  createQuery(selectors){ return   function (context = document){ for ( const  sel of selectors){try{ const  el = context.querySelector(sel); if (el) return  el;}catch(e){}} return  null;};} return {SelectorManager,findByText,findRelative,createQuery,FRAGILE_PATTERNS,SELECTOR_PRIORITY,};})(); if ( typeof  window !== 'undefined'){globalThis.TMSelector = TMSelector;} const  TM =( function (){'use strict'; const {Logger}= TMLogger; const {reactive,computed,watch,ref}= TMReactive; const {Component}= TMComponent; const {html,classNames,waitForElement,waitForElements,debounce,throttle,deepClone,deepMerge,uid,escapeHtml,escapeAttr,parseUrlParams,formatDate,storage}= TMUtils; const  theme = TMTheme; const {SelectorManager,findByText,findRelative,createQuery}= TMSelector; const  injectedStyles =  new  Set(); function  injectStyles(css,id = null){ const  styleId = id || `tm-style-${uid()}`; if (injectedStyles.has(styleId)) return  styleId; const  style = document.createElement('style');style.id = styleId;style.textContent = css;document.head.appendChild(style);injectedStyles.add(styleId); return  styleId;} function  removeStyles(id){ const  style = document.getElementById(id); if (style){style.remove();injectedStyles.delete(id);}} const  plugins =  new  Map(); function  use(name,plugin){ if (plugins.has(name)){console.warn(`[TM]Plugin "${name}" already registered`); return ;}plugins.set(name,plugin); if ( typeof  plugin.install === ' function '){plugin.install(TM);}console.log(`[TM]Plugin "${name}" registered`);} function  getPlugin(name){ return  plugins.get(name);} let  initialized = false; function  init(options ={}){ if (initialized){console.warn('[TM]Already initialized'); return ;}theme.init(); if (options.theme){theme.setMode(options.theme);}initialized = true;console.log('[TM Framework]Initialized v1.0.0');} if (document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',()=> init());} else {setTimeout(()=> init(),0);} const  TM ={version:'1.0.0',Logger,Component,reactive,computed,watch,ref,theme,SelectorManager,Selectors: new  SelectorManager('TM'),findByText,findRelative,createQuery,html,classNames,waitForElement,waitForElements,debounce,throttle,deepClone,deepMerge,uid,escapeHtml,escapeAttr,parseUrlParams,formatDate,storage,debug:{enabled:false,enable(){this.enabled = true;globalThis.TM_DEBUG = true;console.log('[TM Debug]Debug mode enabled');},disable(){this.enabled = false;globalThis.TM_DEBUG = false;console.log('[TM Debug]Debug mode disabled');},getAllComponentInfo(){ const  components =[];document?.querySelectorAll('[data-tm-component]').forEach(el =>{ const  componentId = el.dataset.tmComponent; if (window[componentId]&& window[componentId].getDebugInfo){components.push(window[componentId].getDebugInfo());}}); return  components;},printAllDebugInfo(){ const  info = this.getAllComponentInfo();console.group('ðŸ” TM Framework Debug - All Components');info.forEach(comp =>{console.group(`Component:${comp.componentId}`);console.log(comp);console.groupEnd();});console.groupEnd(); return  info;},clearLogs(){document?.querySelectorAll('[data-tm-component]').forEach(el =>{ const  componentId = el.dataset.tmComponent; if (window[componentId]){window[componentId]._componentLogs =[];window[componentId]._updateLog =[];window[componentId]._stateChangeLog =[];}});console.log('[TM Debug]All component logs cleared');}},injectStyles,removeStyles,use,getPlugin,init}; return  TM;})(); if ( typeof  window !== 'undefined'){globalThis.TM = TM;} if ( typeof  module !== 'undefined' && module.exports){module.exports = TM;}